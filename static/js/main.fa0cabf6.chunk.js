(this["webpackJsonpshakepay-interview-web"]=this["webpackJsonpshakepay-interview-web"]||[]).push([[0],{177:function(t,e,n){"use strict";n.r(e);var a=n(5),o=n.n(a),r=n(50),i=n.n(r),c=(n(59),n.p,n(60),n(14)),s=n(51),u=n(54),h=n(53),l=n(52),g=n(25),T=n.n(g),d=function t(){Object(c.a)(this,t)};d.transactionHistoryEndpoint="https://shakepay.github.io/programming-exercise/web/transaction_history.json",d.exchangeRateEndpoint="https://shakepay.github.io/programming-exercise/web/rates_CAD_BTC.json",d.getTransactionData=function(t){return T()({method:"get",url:t})},d.getExchangeRate=function(t){return T()({method:"get",url:"https://shakepay.github.io/programming-exercise/web/rates_CAD_".concat(t,".json")})};var f=d,b={CAD_BTC:1502e-8,BTC_CAD:66566.3,CAD_ETH:.000428285811176005,ETH_CAD:2334.88,USD_BTC:1907e-8,BTC_USD:52420.81,USD_ETH:.000543856595892794,ETH_USD:1838.72,BTC_ETH:28.506271379703534,ETH_BTC:.03508,CAD_USD:.78,USD_CAD:1.26},v=n(1),C=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).getTransactions=function(){f.getTransactionData(f.transactionHistoryEndpoint).then((function(t){console.log({transactionHistoryResponse:t});var e=t.data;e.sort((function(t,e){return new Date(t.createdAt)-new Date(e.createdAt)})),console.log({transactions:e}),a.setState({transactions:e},(function(){a.calculateBalances()}))}))},a.calculateBalances=function(){var t=a.state,e=t.transactions,n=t.useTransactionTimeExchangeRate,o=[];e.forEach((function(t,e){var n,a,r;0===o.length?(n={CAD:0,BTC:0,ETH:0},console.log("first previousBalances",n)):n=o[e-1].balances,0===e&&(console.log({netWorthHistory:o,transaction:t,previousBalances:n}),console.log("netWorthHistory.length",o.length));var i=Object.assign({},n);a=t.createdAt,"conversion"===t.type?(i[t.from.currency]=n[t.from.currency]-t.from.amount,i[t.to.currency]=n[t.to.currency]+t.to.amount):(r="credit"===t.direction?t.amount:-1*t.amount,i[t.currency]=n[t.currency]+r);var c={balances:i,date:a};o.push(c)})),console.log({netWorthHistory:o}),a.setState({netWorthHistory:o},(function(){a.getExchangeRateAndNetWorth(n)}))},a.toggleTransactionTimeExchangeRate=function(){var t=a.state.useTransactionTimeExchangeRate;a.setState({useTransactionTimeExchangeRate:!t},(function(){a.getExchangeRateAndNetWorth(!t)}))},a.getExchangeRateAndNetWorth=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t){var e=a.state,n=e.BTCRatesOverTime,o=e.ETHRatesOverTime;0===n.length||0===o.length?f.getExchangeRate("BTC").then((function(e){console.log({BTCResponse:e}),a.setState({BTCRatesOverTime:e.data},(function(){f.getExchangeRate("ETH").then((function(e){console.log({ETHResponse:e}),a.setState({ETHRatesOverTime:e.data}),a.calculateNetWorth(t)}))}))})):a.calculateNetWorth(t)}else a.calculateNetWorth(t)},a.getExchangeRatesOnGivenDay=function(t){for(var e=a.state,n=e.BTCRatesOverTime,o=e.ETHRatesOverTime,r={BTC_CAD:"",ETH_CAD:""},i=t.date.substring(0,10),c=0;c<n.length;c++){if(i===n[c].createdAt.substring(0,10)){r.BTC_CAD=n[c].midMarketRate;break}}for(c=0;c<o.length;c++){if(i===o[c].createdAt.substring(0,10)){r.ETH_CAD=o[c].midMarketRate;break}}return r},a.convertBalancesToFiat=function(t,e){return t.CAD+t.BTC*e.BTC_CAD+t.ETH*e.ETH_CAD},a.calculateNetWorth=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=a.state.netWorthHistory;e.forEach((function(e){var n;if(t){var o=a.getExchangeRatesOnGivenDay(e);n=a.convertBalancesToFiat(e.balances,o)}else n=a.convertBalancesToFiat(e.balances,b);e.netWorth=n})),a.setState({netWorthHistory:e})},a.state={transactions:[],BTCRatesOverTime:[],ETHRatesOverTime:[],netWorthHistory:[],useTransactionTimeExchangeRate:!0},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.getTransactions()}},{key:"render",value:function(){var t=this.state,e=t.netWorthHistory,n=t.useTransactionTimeExchangeRate,a={labels:e.map((function(t){return t.date})),datasets:[{label:"Net Worth",fill:!1,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:e.map((function(t){return t.netWorth}))}]};return Object(v.jsxs)("div",{children:[Object(v.jsx)("h2",{children:"Net Worth"}),Object(v.jsx)("button",{onClick:this.toggleTransactionTimeExchangeRate,children:n?"Use Constant Exchange Rate":"Use Transaction Time Exchange Rate"}),Object(v.jsx)(l.Line,{data:a})]})}}]),n}(o.a.Component);var p=function(){return Object(v.jsx)("div",{className:"App",children:Object(v.jsx)(C,{})})},m=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,178)).then((function(e){var n=e.getCLS,a=e.getFID,o=e.getFCP,r=e.getLCP,i=e.getTTFB;n(t),a(t),o(t),r(t),i(t)}))};i.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(p,{})}),document.getElementById("root")),m()},59:function(t,e,n){},60:function(t,e,n){}},[[177,1,2]]]);
//# sourceMappingURL=main.fa0cabf6.chunk.js.map